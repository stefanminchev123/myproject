/*--------------------------------------------------------------------------------------------------------
# VP One Page Checkout - Joomla! System Plugin for VirtueMart 3
----------------------------------------------------------------------------------------------------------
# Copyright:     Copyright (C) 2012 - 2015 VirtuePlanet Services LLP. All Rights Reserved.
# License:       GNU General Public License version 2 or later; http://www.gnu.org/licenses/gpl-2.0.html
# Author:        Abhishek Das
# Email:         info@virtueplanet.com
# Websites:      http://www.virtueplanet.com
----------------------------------------------------------------------------------------------------------
$Revision: 38 $
$LastChangedDate: 2015-03-04 18:17:34 +0530 (Wed, 04 Mar 2015) $
$Id: plugin-min.js 38 2015-03-04 12:47:34Z abhishekdas $
----------------------------------------------------------------------------------------------------------*/
if(VPOPC=window.VPOPC||{},VPOPC.option={},VPOPC.loadOptions=function(t){for(var e in t)this.option[e]=t[e];return this},VPOPC.JText={strings:{},_:function(t,e){return"undefined"!=typeof this.strings[t.toUpperCase()]?this.strings[t.toUpperCase()]:e},sprintf:function(t,e){var o="undefined"!=typeof this.strings[t.toUpperCase()]?this.strings[t.toUpperCase()]:"";return o.replace("%s",e)},load:function(t){for(var e in t)this.strings[e.toUpperCase()]=t[e];return this}},"undefined"==typeof ProOPC||void 0===typeof ProOPC){var jq=jQuery.noConflict(),ProOPC={ajaxPool:{},spinnervars:function(){var t={lines:13,length:3,width:2,radius:5,corners:1,rotate:0,direction:1,color:"#FFF",speed:1.5,trail:60,shadow:!1,hwaccel:!1,className:"proopc-spinner",zIndex:2e9,top:"auto",left:"auto"};proopc_spinner=new VPSpinner(t).spin();var e={lines:10,length:10,width:4,radius:15,corners:1,rotate:0,direction:1,color:VPOPC.option.SPINNER_COLOR,speed:1.5,trail:60,shadow:!1,hwaccel:!0,className:"proopc-page-loader",zIndex:2e9,top:20,left:14};proopc_loader=new VPSpinner(e).spin();var o={lines:10,length:5,width:3,radius:8,corners:1,rotate:0,direction:1,color:VPOPC.option.SPINNER_COLOR,speed:1.5,trail:40,shadow:!1,hwaccel:!0,className:"proopc-area-loader",zIndex:2e9,top:20,left:14};proopc_area_loader=new VPSpinner(o).spin()},opcmethod:function(){var t=jq('input:radio[name="proopc-method"]:checked').val();"guest"==t?(jq(".proopc-reg-form").hide().css("opacity",0),jq(".proopc-reg-advantages, .proopc-guest-form").show().animate({opacity:1},500),ProOPC.inputwidth(),ProOPC.selectwidth()):(jq(".proopc-reg-form").show().animate({opacity:1},500,function(){jq("#ProOPC").find("#dynamic_recaptcha_1").length&&ProOPC.style()}),jq(".proopc-reg-advantages, .proopc-guest-form").hide().css("opacity",0),ProOPC.inputwidth(),ProOPC.selectwidth())},guestcheckout:function(){return jq.ajax({type:"POST",url:VPOPC.option.URI,data:jq("#GuestUser").serialize(),cache:!1,beforeSend:function(){return 0==ProOPC.validateForm("#GuestUser")?!1:void jq("#proopc-guest-process").append(proopc_spinner.el)},success:function(){jq("#proopc-guest-process .proopc-spinner").remove(),ProOPC.setmsg("info",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_EMAIL_SAVED"),!1),ProOPC.processCheckout({error:0})}}),!1},verifyRegForm:function(){jq('#UserLogin input[type="text"]:not(#proopc-secretkey), #UserLogin input[type="password"]').keyup(function(){""==jq(this).val()?jq(this).siblings(".status").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_REQUIRED_FIELD")):jq(this).siblings(".status").removeClass("invalid").removeAttr("title")}),jq('#GuestUser input[type="text"]').keyup(function(){var t=jq(this);if("email_field"==jq(this).attr("id")){var e=jq(t).val();ProOPC.validateEmail(e)?(jq(t).removeClass("invalid").addClass("valid"),jq(t).siblings(".status").removeClass("invalid").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED"))):(jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_EMAIL_INVALID")))}}),jq('#UserRegistration input[type="text"], #UserRegistration input[type="password"]').keyup(function(){var t=jq(this);if("email_field"==jq(this).attr("id")){var e=jq(t).val(),o=this;ProOPC.validateEmail(e)?1==VPOPC.option.AJAXVALIDATION?(ProOPC.ajaxPool.hasOwnProperty("checkemail")&&4!=ProOPC.ajaxPool.checkemail.readystate&&ProOPC.ajaxPool.checkemail.abort(),ProOPC.ajaxPool.checkemail=jq.ajax({beforeSend:function(){jq(t).siblings(".status").removeClass("hover-tootip").removeClass("invalid").removeClass("valid").addClass("validating")},dataType:"JSON",url:VPOPC.option.URI,data:"ctask=checkemail&email="+e,cache:!1,success:function(e){1!==e.valid?(jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").removeClass("validating").addClass("hover-tootip").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_INVALID")),jq(o).addClass("hasFieldTip").attr("title",VPOPC.JText._("COM_USERS_PROFILE_EMAIL1_MESSAGE")),ProOPC.fieldTip(),ProOPC.showFieldTip(o)):(ProOPC.removeFieldTip(o,!1),jq(o).attr("title","").removeClass("hasFieldTip"),jq(t).removeClass("invalid").addClass("valid"),jq(t).siblings(".status").removeClass("validating").removeClass("invalid").addClass("hover-tootip").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED")))}})):(jq(t).removeClass("invalid").addClass("valid"),jq(t).siblings(".status").removeClass("invalid").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED"))):(jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_EMAIL_INVALID")))}else if("username_field"==jq(this).attr("id")){var a=jq(t).val(),r=this;ProOPC.validateUsername(a)?1==VPOPC.option.AJAXVALIDATION?(ProOPC.ajaxPool.hasOwnProperty("checkusername")&&4!=ProOPC.ajaxPool.checkusername.readystate&&ProOPC.ajaxPool.checkusername.abort(),ProOPC.ajaxPool.checkusername=jq.ajax({dataType:"JSON",url:VPOPC.option.URI,data:"ctask=checkuser&username="+a,cache:!1,beforeSend:function(){jq(t).siblings(".status").removeClass("hover-tootip").removeClass("invalid").removeClass("valid").addClass("validating")},success:function(e){1!==e.valid?(jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").removeClass("validating").addClass("hover-tootip").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_INVALID")),jq(r).addClass("hasFieldTip").attr("title",VPOPC.JText._("COM_USERS_PROFILE_USERNAME_MESSAGE")),ProOPC.fieldTip(),ProOPC.showFieldTip(r)):(ProOPC.removeFieldTip(r,!1),jq(r).attr("title","").removeClass("hasFieldTip"),jq("#proopc-system-message").html(""),jq(t).removeClass("invalid").addClass("valid"),jq(t).siblings(".status").removeClass("invalid").removeClass("validating").addClass("hover-tootip").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED")))}})):(jq(t).removeClass("invalid").addClass("valid"),jq(t).siblings(".status").removeClass("invalid").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED"))):(jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_USERNAME_INVALID")))}else if("password_field"==jq(this).attr("id")){var s=jq(t).val(),i=jq("#password2_field");i.removeClass("valid"),i.siblings(".status").removeClass("valid"),ProOPC.removeFieldTip(t,!1),""==s?(jq("#password-stregth, #meter-status").attr("class","").addClass("invalid"),jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_INVALID")),jq("#password-stregth").text("")):ProOPC.validatePassword(t)?ProOPC.checkStrength(s):(jq("#password-stregth, #meter-status").attr("class","").addClass("invalid"),jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_INVALID")),jq("#password-stregth").text(""))}else if("password2_field"==jq(this).attr("id")){var n=jq("#password_field").val(),p=jq(t).val();p!==n||""==p?(jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_INVALID"))):(jq(t).removeClass("invalid").addClass("valid"),jq(t).siblings(".status").removeClass("invalid").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED")))}else if("name_field"==jq(this).attr("id")){var d=jq(t).val();0==d.length?(jq(t).removeClass("valid").addClass("invalid"),jq(t).siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_INVALID"))):(jq(t).removeClass("invalid").addClass("valid"),jq(t).siblings(".status").removeClass("invalid").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED")))}})},validateEmail:function(t){if(VPOPC.option.DISABLELIVEVALIDATION)return!0;var e=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return!e.test(t)||t.length<5?!1:!0},validateUsername:function(t){if(VPOPC.option.DISABLELIVEVALIDATION)return!0;var e=/^[a-zA-Z0-9]+$/;return e.test(t)?!0:!1},validatePassword:function(t){if(VPOPC.option.DISABLELIVEVALIDATION)return!0;var e=jq(t),o=e.val();ProOPC.removeFieldTip(t,!1),e.attr("title","").removeClass("hasFieldTip");var a=!1;if(o.indexOf(" ")>=0)e.addClass("hasFieldTip").attr("title",VPOPC.JText._("COM_USERS_MSG_SPACES_IN_PASSWORD")),a=!0;else if(VPOPC.option.PASSWORD_INTEGERS||VPOPC.option.PASSWORD_SYMBOLS||VPOPC.option.PASSWORD_UPPERCASE){var r=o.match(/\d/g),s=o.match(/\W/g),i=o.match(/[A-Z]/g);VPOPC.option.PASSWORD_INTEGERS>0&&(!r||r.length<VPOPC.option.PASSWORD_INTEGERS)?(1==VPOPC.option.PASSWORD_INTEGERS?e.addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N_1",VPOPC.option.PASSWORD_INTEGERS)):e.addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N",VPOPC.option.PASSWORD_INTEGERS)),a=!0):VPOPC.option.PASSWORD_SYMBOLS>0&&(!s||s.length<VPOPC.option.PASSWORD_SYMBOLS)?(1==VPOPC.option.PASSWORD_SYMBOLS?e.addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N_1",VPOPC.option.PASSWORD_SYMBOLS)):e.addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N",VPOPC.option.PASSWORD_SYMBOLS)),a=!0):VPOPC.option.PASSWORD_UPPERCASE>0&&(!i||i.length<VPOPC.option.PASSWORD_UPPERCASE)&&(1==VPOPC.option.PASSWORD_UPPERCASE?e.addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N_1",VPOPC.option.PASSWORD_UPPERCASE)):e.addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N",VPOPC.option.PASSWORD_UPPERCASE)),a=!0)}else VPOPC.option.PASSWORD_LENGTH>0&&o.length<VPOPC.option.PASSWORD_LENGTH&&(e.addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_PASSWORD_TOO_SHORT_N",VPOPC.option.PASSWORD_LENGTH)),a=!0);return a?(ProOPC.fieldTip(),ProOPC.showFieldTip(t),!1):!0},checkStrength:function(t){if(VPOPC.option.DISABLELIVEVALIDATION)return!0;var e=0;return t.length<4?(jq("#password-stregth, #meter-status").attr("class","").addClass("short"),jq("#password_field").removeClass("valid").addClass("invalid"),jq("#password_field").siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_INVALID")),jq("#password-stregth").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_TOO_SHORT")),!1):(t.length>4&&(e+=1),t.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(e+=1),t.match(/([a-zA-Z])/)&&t.match(/([0-9])/)&&(e+=1),t.match(/([!,%,&,@,#,$,^,*,?,_,~])/)&&(e+=1),t.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,",%,&,@,#,$,^,*,?,_,~])/)&&(e+=1),void(2>e?(jq("#password-stregth, #meter-status").attr("class","").addClass("weak"),jq("#password_field").removeClass("invalid").addClass("valid"),jq("#password_field").siblings(".status").removeClass("invalid").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED")),jq("#password-stregth").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_WEAK"))):2==e?(jq("#password-stregth, #meter-status").attr("class","").addClass("good"),jq("#password_field").removeClass("invalid").addClass("valid"),jq("#password_field").siblings(".status").removeClass("invalid").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED")),jq("#password-stregth").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_GOOD"))):(jq("#password-stregth, #meter-status").attr("class","").addClass("strong"),jq("#password_field").removeClass("invalid").addClass("valid"),jq("#password_field").siblings(".status").removeClass("invalid").addClass("valid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VALIDATED")),jq("#password-stregth").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_STRONG")))))},registerCheckout:function(){var t="&ctask=register";return jq.ajax({dataType:"json",type:"POST",beforeSend:function(){return 0==ProOPC.validateForm("#UserRegistration")?!1:void jq("#proopc-register-process").append(proopc_spinner.el)},url:VPOPC.option.URI,data:jq("#UserRegistration").serialize()+t,cache:!1,success:function(t){t.msg?1==t.error?(jq("#proopc-register-process .proopc-spinner").remove(),ProOPC.setmsg("1",t.msg),t.reload&&window.location.reload(),"undefined"!=typeof Recaptcha&&Recaptcha.reload(),jq(document).trigger("vpopc.event",["registration.failed"])):(ProOPC.setmsg("3",t.msg),jq(document).trigger("vpopc.event",["registration.success"]),1==t.stop?jq("#proopc-register-process .proopc-spinner").remove():setTimeout(function(){jq("#proopc-register-process .proopc-spinner").remove(),VPOPC.option.RELOAD?window.location.reload():ProOPC.processCheckout(t)},3e3)):"1"==t||1==t?(jq("#proopc-register-process .proopc-spinner").remove(),ProOPC.setmsg("3",VPOPC.JText._("COM_VIRTUEMART_REG_COMPLETE")),jq(document).trigger("vpopc.event",["registration.success"]),VPOPC.option.RELOAD?window.location.reload():ProOPC.processCheckout({error:0})):"string"===jq.type(t)&&-1==t.indexOf("</head>")?(jq("#proopc-register-process .proopc-spinner").remove(),ProOPC.setmsg("3",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_REGISTRATION_NEED_LOGIN")),jq(document).trigger("vpopc.event",["registration.failed"])):(jq("#proopc-register-process .proopc-spinner").remove(),ProOPC.setmsg("3",VPOPC.JText._("COM_VIRTUEMART_REG_COMPLETE")),jq(document).trigger("vpopc.event",["registration.success"]),VPOPC.option.RELOAD?window.location.reload():ProOPC.processCheckout({error:0}))},error:function(t,e,o){console.log(t),console.log(e),console.log(o),jq("#proopc-register-process .proopc-spinner").remove(),ProOPC.setmsg("1","Error submiting registration form (registerCheckout). Reload the page and try again.")}}),!1},processCheckout:function(t){if(ProOPC.addpageloader(),jq("#proopc-page-spinner").after('<div id="proopc-order-process"></div>'),jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_PLEASE_WAIT")),0==t.error){var t=jq("#ProOPC").html(),e=ProOPC.getUrlVars();jq.ajax({url:VPOPC.option.URI,data:"task=procheckout&"+e,dataType:"html",cache:!1,success:function(t){var e=jq(t).find("#ProOPC").html();if(null==e)var e=t;jq("#ProOPC").html(e),jq(document).trigger("vpopc.event",["checkout.finalstage"]),VPOPC.option.RELOAD||jq("html, body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500)},complete:function(){var t=jq("input#BTStateID").val(),e=jq("input#STStateID").val();jq("#virtuemart_country_id").vm2front("list",{dest:"#virtuemart_state_id",ids:t,prefiks:""}),jq("#shipto_virtuemart_country_id").vm2front("list",{dest:"#shipto_virtuemart_state_id",ids:e,prefiks:"shipto_"}),jq("#virtuemart_country_id").change(function(){jq("#virtuemart_state_id optgroup").length>0&&(jq("#virtuemart_state_id optgroup").remove(),jq("#virtuemart_country_id").vm2front("list",{dest:"#virtuemart_state_id",ids:"",prefiks:""}))}),jq("#shipto_virtuemart_country_id").change(function(){jq("#shipto_virtuemart_state_id optgroup").length>0&&(jq("#shipto_virtuemart_state_id optgroup").remove(),jq("#shipto_virtuemart_country_id").vm2front("list",{dest:"#shipto_virtuemart_state_id",ids:"",prefiks:"shipto_"}))}),ProOPC.style(),ProOPC.tooltip(),ProOPC.inputwidth(),ProOPC.selectwidth(),jq("#proopc-order-process").remove(),ProOPC.removepageloader(),ProOPC.defaultSP(),klarnaExits="undefined"==typeof klarna?!1:!0,klarnaExits&&ProOPC.loadPaymentScripts(),ProOPC.loadShipmentScripts()}})}else{var o="";jq.each(t.msg,function(t,e){o=o+'<div class="error-msg">'+e+"</div>"}),jq("#proopc-system-message").html(o),jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500),jq("#proopc-system-message").children("span").animate({opacity:0},2e3)}},loginAjax:function(){if(0==ProOPC.validateForm("#UserLogin"))return!1;var t=jq('form#UserLogin input[name="ctask"]:hidden');return"login"!=t.val()&&t.val("login"),jq.ajax({type:"POST",beforeSend:function(){jq("#proopc-login-process").append(proopc_spinner.el)},url:VPOPC.option.URI,data:jq("form#UserLogin").serialize(),cache:!1,success:function(t){"1"==t||1==t?(jq("#proopc-login-process .proopc-spinner").remove(),ProOPC.setmsg("success",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_LOGIN_COMPLETED")),jq(document).trigger("vpopc.event",["login.success"]),VPOPC.option.RELOAD?window.location.reload():ProOPC.processCheckout({error:0})):-1==t.indexOf("</head>")?(jq("#proopc-login-process .proopc-spinner").remove(),ProOPC.setmsg("error",VPOPC.JText._("JLIB_LOGIN_AUTHENTICATE")),jq(document).trigger("vpopc.event",["login.failed"])):(ProOPC.setmsg("success",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_LOGIN_COMPLETED")),jq(document).trigger("vpopc.event",["login.success"]),VPOPC.option.RELOAD?window.location.reload():ProOPC.processCheckout({error:0}))},error:function(t,e,o){ProOPC.setmsg("1","Login failed. Please refersh the page and try again."),console.log(t),console.log(e),console.log(o)}}),!1},updateBTaddress:function(t){if(jq("#proopc-order-submit").attr("disabled","disabled"),"virtuemart_country_id"==jq(t).attr("id")||"virtuemart_state_id"==jq(t).attr("id")){var e=jq(t).val();jq(t).find('[selected="selected"]').removeAttr("selected"),jq(t).find('option[value="'+e+'"]').attr("selected","selected")}var o=jq("#EditBTAddres").serialize(),a=jq("#formToken input").attr("name"),r=jq("#formToken input").val(),s="&ctask=savebtaddress&"+a+"="+r;ProOPC.ajaxPool.hasOwnProperty("updateBTaddress")&&4!=ProOPC.ajaxPool.updateBTaddress.readystate&&ProOPC.ajaxPool.updateBTaddress.abort(),ProOPC.ajaxPool.updateBTaddress=jq.ajax({type:"POST",url:VPOPC.option.URI,data:o+s,cache:!1,success:function(){jq(document).trigger("vpopc.event",["checkout.bt.updated"]),ProOPC.getshipmentpaymentcartlist()}})},updateSTaddress:function(t){if(jq("#proopc-order-submit").attr("disabled","disabled"),"shipto_virtuemart_country_id"==jq(t).attr("id")||"shipto_virtuemart_state_id"==jq(t).attr("id")){var e=jq(t).val();jq(t).find('[selected="selected"]').removeAttr("selected"),jq(t).find('option[value="'+e+'"]').attr("selected","selected")}var o=jq("#EditSTAddres").serialize(),a=jq("#formToken input").attr("name"),r=jq("#formToken input").val(),s="&ctask=savestaddress&"+a+"="+r;ProOPC.ajaxPool.hasOwnProperty("updateSTaddress")&&4!=ProOPC.ajaxPool.updateSTaddress.readystate&&ProOPC.ajaxPool.updateSTaddress.abort(),ProOPC.ajaxPool.updateSTaddress=jq.ajax({type:"POST",url:VPOPC.option.URI,data:o+s,cache:!1,success:function(t){jq(document).trigger("vpopc.event",["checkout.st.updated"]),t.userinfo_id&&jq("input#shipto_virtuemart_userinfo_id").val(t.userinfo_id),ProOPC.getshipmentpaymentcartlist()}})},selectSTAddress:function(t){var e=jq(t).val();ProOPC.ajaxPool.hasOwnProperty("selectSTAddress")&&4!=ProOPC.ajaxPool.selectSTAddress.readystate&&ProOPC.ajaxPool.selectSTAddress.abort(),ProOPC.ajaxPool.selectSTAddress=jq.ajax({beforeSend:function(){ProOPC.addloader("#proopc-st-address")},dataType:"json",type:"POST",url:VPOPC.option.URI,data:"ctask=selectstaddress&shipto_virtuemart_userinfo_id="+e,cache:!1,success:function(t){jq("#proopc-st-address").html(t.editst),jq(document).trigger("vpopc.event",["checkout.stselected"]),jq("#shipto_virtuemart_country_id").vm2front("list",{dest:"#shipto_virtuemart_state_id",ids:'"'+t.stateid+'"',prefiks:"shipto_"})},complete:function(){ProOPC.style(),ProOPC.inputwidth(),ProOPC.selectwidth(),ProOPC.removeloader("#proopc-st-address"),ProOPC.getshipmentpaymentcartlist()},error:function(t,e,o){console.log("Error: fetching shipping address"),console.log(t),console.log(e),console.log(o)}})},setst:function(t){jq("#proopc-order-submit").attr("disabled","disabled"),jq(t).length>0&&(ProOPC.ajaxPool.hasOwnProperty("btasst")&&4!=ProOPC.ajaxPool.btasst.readystate&&ProOPC.ajaxPool.btasst.abort(),ProOPC.ajaxPool.btasst=jq.ajax(t.checked?{beforeSend:function(){jq(".proopc-st-address .edit-address").slideUp()},type:"post",url:VPOPC.option.URI,data:"ctask=btasst",cache:!1,success:function(){jq(document).trigger("vpopc.event",["checkout.btasst"]),ProOPC.getshipmentpaymentcartlist()}}:{beforeSend:function(){jq(".proopc-st-address .edit-address").slideDown(),ProOPC.inputwidth(),ProOPC.selectwidth()},type:"post",url:VPOPC.option.URI,data:"ctask=btnotasst",cache:!1,success:function(){jq(document).trigger("vpopc.event",["checkout.btnotasst"]);var t=jq("select#proopc-select-st");t.length&&t.val()>0?ProOPC.selectSTAddress(t[0]):ProOPC.updateSTaddress()}}))},getshipmentpaymentcartlist:function(){ProOPC.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),ProOPC.ajaxPool.hasOwnProperty("getshipmentpaymentcartlist")&&4!=ProOPC.ajaxPool.getshipmentpaymentcartlist.readystate&&ProOPC.ajaxPool.getshipmentpaymentcartlist.abort(),ProOPC.ajaxPool.getshipmentpaymentcartlist=jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=getshipmentpaymentcartlist",cache:!1,success:function(t){jq("#proopc-shipments").html(t.shipments),jq("#proopc-payments").html(t.payments),jq("#proopc-pricelist").html(t.cartlist),t.payment_scripts.length>0&&""!==t.payment_scripts[0]&&(payment_scripts=t.payment_scripts),""!==t.payment_script[0]&&jq.each(t.payment_script,function(t,e){jq.getScript(e,function(){"undefined"!=typeof payment_scripts&&jq.each(payment_scripts,function(t,e){})})}),t.shipment_scripts.length>0&&""!==t.shipment_scripts[0]&&jq.each(t.shipment_scripts,function(t,e){jq("head").append('<script type="text/javascript">'+e+"</script>")})},complete:function(){ProOPC.style(),ProOPC.tooltip(),ProOPC.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),ProOPC.defaultSP()},error:function(t,e,o){ProOPC.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),console.log("Error: Error gettings Shipments, Payments and Cartlist (getshipmentpaymentcartlist)."),console.log(t),console.log(e),console.log(o)}})},defaultSP:function(){var t="";if(-1!=VPOPC.option.AUTOSHIPMENT){var e=jq('#proopc-shipments input:radio[name="virtuemart_shipmentmethod_id"]:checked').val();if(jq('#proopc-shipments input:radio[name="virtuemart_shipmentmethod_id"]').length){var o=!1;if(jq("#proopc-savedShipment").val()&&jq('#proopc-shipments input:radio[name="virtuemart_shipmentmethod_id"]').each(function(){return e||jq(this).val()!=jq("#proopc-savedShipment").val()?void 0:(jq(this).attr("checked",!0),o=!0,!1)}),!o&&!e){VPOPC.option.AUTOSHIPMENT>0?jq('#proopc-shipments input:radio[name="virtuemart_shipmentmethod_id"][value="'+VPOPC.option.AUTOSHIPMENT+'"]').attr("checked",!0):jq('#proopc-shipments input:radio[name="virtuemart_shipmentmethod_id"]:first').attr("checked",!0);var a=jq('#proopc-shipments input:radio[name="virtuemart_shipmentmethod_id"]:checked').val();t=t+"&virtuemart_shipmentmethod_id="+a;var r=jq('#proopc-shipments input:radio[name="virtuemart_shipmentmethod_id"]:checked').data("usps");if(jq("#usps_name-"+a).length){var s="usps_name-"+a+"="+r.service;t=t+"&"+s}if(jq("#usps_rate-"+a).length){var i="usps_rate-"+a+"="+r.rate;t=t+"&"+i}}}}var n=jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:first').attr("data-paypalproduct");if(-1!=VPOPC.option.AUTOPAYMENT&&"exp"!=n){var e=jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:checked').val();if(jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]').length){var p=!1;if(jq("#proopc-savedPayment").val()&&jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]').each(function(){return e||e!=jq("#proopc-savedPayment").val()?void 0:(jq(this).attr("checked",!0),p=!0,!1)}),!p&&!e){VPOPC.option.AUTOPAYMENT>0?jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"][value="'+VPOPC.option.AUTOPAYMENT+'"]').attr("checked",!0):jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:first').attr("checked",!0);var d=jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:checked').data("pmtype");jq(".vmpayment_cardinfo").removeClass("show").addClass("hide"),jq(".vmpayment_cardinfo."+d).removeClass("hide").addClass("show");var c=jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:checked').val(),l=0;if(jq(".vmpayment_cardinfo."+d).length>0||"sisowideal"==jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:checked').data("pmtype"))l=1;else if(jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:checked').hasClass("klarnaPayment")){var m=jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:checked').next('input[name="klarna_paymentmethod"]').val();l="1&klarna_paymentmethod="+m}var P="";"piraeus"==jq('#proopc-payments input:radio[name="virtuemart_paymentmethod_id"]:checked').data("pmtype")&&jq(".vmpayment_cardinfo.piraeus").find("select, input").each(function(){P=P+"&"+jq(this).attr("name")+"="+jq(this).val()}),t=t+"&virtuemart_paymentmethod_id="+c+"&payment_data="+l+P}}}""!==t&&jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=setdefaultsp&ajax=1"+t,cache:!1,beforesend:function(){jq("#proopc-order-submit").attr("disabled","disabled")},success:function(t){t.error?(jq(document).trigger("vpopc.event",["checkout.defaultsp.failed"]),jq("#proopc-order-submit").removeAttr("disabled"),console.log("Error: Setting default Shipment & Payment Method. Please select manually.")):(jq(document).trigger("vpopc.event",["checkout.defaultsp.success"]),ProOPC.getcartlist())},error:function(t,e,o){console.log("Error: Setting default Shipment & Payment Method."),console.log(t),console.log(e),console.log(o)}})},setshipment:function(t){if(jq("#proopc-order-submit").attr("disabled","disabled"),jq(t).length>0){var e=jq(t).val(),o="&virtuemart_shipmentmethod_id="+e,a=jq(t).data("usps");if(jq("#usps_name-"+e).length){var r="usps_name-"+e+"="+a.service;o=o+"&"+r}if(jq("#usps_rate-"+e).length){var s="usps_rate-"+e+"="+a.rate;o=o+"&"+s}var i=jq(t).data("ups");if(jq("#ups_rate-"+e).length){var n="ups_rate-"+e+"="+i.id;o=o+"&"+n}ProOPC.ajaxPool.hasOwnProperty("setshipment")&&4!=ProOPC.ajaxPool.setshipment.readystate&&ProOPC.ajaxPool.setshipment.abort(),ProOPC.ajaxPool.setshipment=jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=setshipments"+o,cache:!1,success:function(t){t.error?(ProOPC.setmsg("2",t.msg),jq(document).trigger("vpopc.event",["checkout.shipmentselection.failed",e])):(jq(document).trigger("vpopc.event",["checkout.shipmentselection.success",e]),ProOPC.getcartlist(),jq(document).trigger("shipmentUpdate",[e]),1==VPOPC.option.RELOADPAYMENTS&&ProOPC.getpayments())},error:function(){console.log("Shipment Method selection problem (setshipment)"),jq("#proopc-order-submit").removeAttr("disabled")}})}},setpayment:function(t){if(jq("#proopc-order-submit").attr("disabled","disabled"),jq(t).is(":checked")){var e=jq(t).data("pmtype");jq(t).data("paypalproduct")&&(e+=jq(t).data("paypalproduct")),jq(".klarna_box_bottom").hide(),jq(".vmpayment_cardinfo").removeClass("show").addClass("hide"),jq(".vmpayment_cardinfo."+e).removeClass("hide").addClass("show")}if(jq(t).is(":checked")&&jq(t).hasClass("klarnaPayment")&&ProOPC.klarnaOpenClose(t),jq(t).length>0){var o=jq(t).val(),a=0,r=0;jq(".vmpayment_cardinfo."+e).length>0||"sisowideal"==jq(t).data("pmtype")?a=1:jq(t).hasClass("klarnaPayment")&&(a="1&"+jq("form#proopc-payment-form").serialize()+"&savecc=1",r=1);var s="";"piraeus"==jq(t).data("pmtype")&&jq(".vmpayment_cardinfo.piraeus").find("select, input").each(function(){s=s+"&"+jq(this).attr("name")+"="+jq(this).val()}),"exp"==jq(t).data("paypalproduct")&&ProOPC.setmsg(4,VPOPC.JText._("VMPAYMENT_PAYPAL_REDIRECT_MESSAGE")),ProOPC.ajaxPool.hasOwnProperty("setpayment")&&4!=ProOPC.ajaxPool.setpayment.readystate&&ProOPC.ajaxPool.setpayment.abort(),ProOPC.ajaxPool.setpayment=jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=setpayment&ajax=1&virtuemart_paymentmethod_id="+o+"&payment_data="+a+s,cache:!1,type:"post",success:function(t){t.redirect=t.redirect?t.redirect:0,t.error?(ProOPC.setmsg("2",t.msg),jq(document).trigger("vpopc.event",["checkout.paymentselection.failed",o]),ProOPC.getcartlist()):t.redirect?(jq(document).trigger("vpopc.event",["checkout.paymentselection.successs",o]),ProOPC.getcartlist(t.redirect),jq(document).trigger("paymentUpdate",[o])):(t.msg&&r&&ProOPC.setmsg("2",t.msg),jq(document).trigger("vpopc.event",["checkout.paymentselection.successs",o]),ProOPC.getcartlist(),jq(document).trigger("paymentUpdate",[o]))},error:function(){console.log("Payment Method selection problem (setpayment)"),jq("#proopc-order-submit").removeAttr("disabled")}})}},getcartlist:function(t){ProOPC.addloader("#proopc-pricelist"),ProOPC.ajaxPool.hasOwnProperty("getcartlist")&&4!=ProOPC.ajaxPool.getcartlist.readystate&&ProOPC.ajaxPool.getcartlist.abort(),ProOPC.ajaxPool.getcartlist=jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=getcartlist",cache:!1,success:function(t){jq("#proopc-pricelist").html(t.cartlist)},complete:function(){ProOPC.style(),"undefined"!=typeof t&&(window.location=t),ProOPC.removeloader("#proopc-pricelist")},error:function(t,e,o){console.log("Carlist Error: Error getting Cartlist Data (getcartlist)."),console.log(t),console.log(e),console.log(o)}})},getpayments:function(){ProOPC.addloader("#proopc-payments"),ProOPC.ajaxPool.hasOwnProperty("getpayments")&&4!=ProOPC.ajaxPool.getpayments.readystate&&ProOPC.ajaxPool.getpayments.abort(),ProOPC.ajaxPool.getpayments=jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=getpaymentlist",cache:!1,success:function(t){jq("#proopc-payments").html(t.payments),t.payment_scripts.length>0&&""!==t.payment_scripts[0]&&(payment_scripts=t.payment_scripts),""!==t.payment_script[0]&&jq.each(t.payment_script,function(t,e){jq.getScript(e,function(){"undefined"!=typeof payment_scripts&&jq.each(payment_scripts,function(t,e){})})})},complete:function(){ProOPC.style(),ProOPC.tooltip(),ProOPC.removeloader("#proopc-payments"),ProOPC.defaultSP()},error:function(){console.log("Error: Error gettings Payments (getpayments).")}})},deleteproduct:function(t){var e=jq(t).attr("data-vpid");return jq.ajax({beforeSend:function(){ProOPC.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments")},type:"POST",url:VPOPC.option.URI,data:"ctask=deleteproduct&id="+e,cache:!1,success:function(t){return jq(document).trigger("vpopc.event",["checkout.products.deleted"]),jq("#proopc-system-message").html(""),jq(".proopc-product-hover").addClass("hide"),0==t.pqty?(window.location.reload(),!1):(jq("input#proopc-cart-summery").length>0?(jq(document).trigger("productDelete",[e]),ProOPC.getcartsummery(),jq("#proopc-cart-totalqty").text(t.pqty)):(jq(document).trigger("productDelete",[e]),ProOPC.getshipmentpaymentcartlist(),jq("#proopc-cart-totalqty").length>0&&jq("#proopc-cart-totalqty").text(t.pqty)),void jq("body").trigger("updateVirtueMartCartModule"))}}),!1},updateproductqty:function(){ProOPC.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments");var t=!1;return jq(".proopc-qty-input").each(function(){return jq(this).data("quantity")!=jq(this).val()?(t=!0,!1):void 0}),t?(jq.ajax({dataType:"JSON",url:VPOPC.option.URI,data:jq("#proopc-carttable-form").serialize(),cache:!1,success:function(t){if(0!==t.error){if(jq(document).trigger("vpopc.event",["checkout.products.updated",t.pqty]),0==t.pqty)return window.location.reload(),!1;ProOPC.setmsg("1",t.msg),jq("input#proopc-cart-summery").length>0?(jq("body").trigger("updateVirtueMartCartModule"),ProOPC.getcartsummery()):(jq("body").trigger("updateVirtueMartCartModule"),ProOPC.getshipmentpaymentcartlist())}else jq("#proopc-system-message").html(""),jq(".proopc-product-hover").addClass("hide"),jq("input#proopc-cart-summery").length>0?(ProOPC.getcartsummery(),jq("#proopc-cart-totalqty").text(t.pqty)):(ProOPC.getshipmentpaymentcartlist(),jq("#proopc-cart-totalqty").text(t.pqty)),jq("body").trigger("updateVirtueMartCartModule")
},error:function(t,e,o){console.log(t),console.log(e),console.log(o)}}),!1):(setTimeout(function(){ProOPC.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments")},300),!1)},getcartsummery:function(){ProOPC.addloader("#proopc-pricelist"),ProOPC.ajaxPool.hasOwnProperty("getcartsummery")&&4!=ProOPC.ajaxPool.getcartsummery.readystate&&ProOPC.ajaxPool.getcartsummery.abort(),ProOPC.ajaxPool.getcartsummery=jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=getcartsummery",cache:!1,success:function(t){jq("#proopc-cart-qty").text(t.pqty),jq("#proopc-pricelist").html(t.cartsummery)},complete:function(){ProOPC.style(),ProOPC.removeloader("#proopc-pricelist")},error:function(){console.log("Carlist Error: Error getting Cartlist Data (getcartlist).")}})},inputwidth:function(){VPOPC.option.GROUPING&&(jq(".title-group").length&&jq(".first_name-group").length&&jq(".title-group, .first_name-group").wrapAll('<div class="proopc-row group-enabled" />'),jq(".middle_name-group").length&&jq(".last_name-group").length&&jq(".middle_name-group, .last_name-group").wrapAll('<div class="proopc-row group-enabled" />'),jq(".zip-group").length&&jq(".city-group").length&&jq(".zip-group, .city-group").wrapAll('<div class="proopc-row group-enabled" />'),jq(".shipto_middle_name-group").length&&jq(".shipto_last_name-group").length&&jq(".shipto_middle_name-group, .shipto_last_name-group").wrapAll('<div class="proopc-row group-enabled" />'),jq(".shipto_zip-group").length&&jq(".shipto_city-group").length&&jq(".shipto_zip-group, .shipto_city-group").wrapAll('<div class="proopc-row group-enabled" />')),jq('.proopc-bt-address input[type="text"], .proopc-st-address input[type="text"]').each(function(){var t=jq(this).parent(".inner").width();jq(this).width(t-15)}),jq('.proopc-register-login input[type="text"], .proopc-register-login input[type="password"]').each(function(){var t=jq(this).parent(".proopc-input").width();jq(this).width(t-27)}),jq(".proopc-register-login button").each(function(){var t=jq(this).parent(".proopc-input").outerWidth(!0);jq(this).width(t)});var t=jq("#proopc-coupon .proopc-input-append").width(),e=jq("#proopc-coupon").find("button.proopc-btn").outerWidth(!0);jq("#proopc-coupon-code").width(t-e-20).css("margin-right",5)},selectwidth:function(){jq(".proopc-bt-address select, .proopc-st-address select").each(function(){var t=jq(this).parent(".inner").width();jq(this).outerWidth(t-3)}),jq(".proopc-register-login select").each(function(){var t=jq(this).parent(".proopc-input").width();jq(this).outerWidth(t-27)})},productdetails:function(){var t={interval:100,sensitivity:4,over:ProOPC.openproductdetails,timeout:200,out:ProOPC.closeproductdetails};jq(".proopc-cart-product").hoverIntent(t)},openproductdetails:function(){var t=jq(this).attr("data-details");jq(this).addClass("open");var e=jq(this).width();jq(this).find(".proopc-p-info-table").width(e);var o=jq(this).position().top,a=jq(this).height(),r=jQuery.easing.jswing||"undefined"!=jQuery.easing.jswing?"easeOutExpo":"linear";jq("#"+t).show().animate({opacity:1,top:o+a},300,r)},closeproductdetails:function(){var t=jq(this).attr("data-details");jq(this).removeClass("open");var e=jQuery.easing.jswing||"undefined"!=jQuery.easing.jswing?"easeOutExpo":"linear";jq("#"+t).animate({opacity:0,top:0},300,e,function(){jq(this).hide()})},savecoupon:function(){var t=jq("#proopc-coupon-code"),e=t.val(),o=t.attr("data-default");if(e==o)ProOPC.setmsg(1,VPOPC.JText._("PLG_VPONEPAGECHECKOUT_COUPON_EMPTY"));else{var a="ctask=setcoupon&coupon_code="+encodeURIComponent(e);jq.ajax({beforeSend:function(){jq("#proopc-order-submit").attr("disabled","disabled"),ProOPC.addloader("#proopc-coupon"),jq("#proopc-coupon-process").append(proopc_spinner.el)},dataType:"JSON",url:VPOPC.option.URI,data:a,cache:!1,success:function(a){jq(document).trigger("vpopc.event",["checkout.coupon.submitted",e,a.msg]),a.error=a.error?a.error:"success",t.val(o),ProOPC.setmsg(a.error,a.msg),1==VPOPC.option.RELOADALLFORCOUPON?ProOPC.getshipmentpaymentcartlist():ProOPC.getcartlist()},error:function(){ProOPC.removeloader("#proopc-coupon"),ProOPC.setmsg(1,"Coupon Error: Data could not be fetched.")},complete:function(){ProOPC.removeloader("#proopc-coupon")}})}return!1},setmsg:function(t,e,o){if(o="undefined"==typeof o||void 0===typeof o?!0:o,"1"==t||"error"==t)var a='<div class="proopc-alert proopc-error-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+e+"</div>";else if("2"==t||"warning"==t)var a='<div class="proopc-alert proopc-warning-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+e+"</div>";else if("3"==t||"success"==t)var a='<div class="proopc-alert proopc-success-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+e+"</div>";else if("4"==t||"info"==t)var a='<div class="proopc-alert proopc-info-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+e+"</div>";else var a='<div class="proopc-alert"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+e+"</div>";jq("#proopc-system-message").html(a),o&&jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500)},addloader:function(t){var e='<div class="proopc-loader-overlay"></div><div class="proopc-area-loader"><span></span></div>';jq(t).each(function(){0==jq(this).find(".proopc-area-loader").length&&(jq(this).append(e),jq(".proopc-area-loader > span").append(proopc_area_loader.el))}),jq("#header .navigation.sticky").css("z-index",2e9),jq("#proopc-order-submit").attr("disabled","disabled")},removeloader:function(t){jq(t).each(function(){jq(this).find(".proopc-loader-overlay").length>0&&(jq(this).find(".proopc-loader-overlay").remove(),jq(this).find(".proopc-area-loader").remove())}),jq("#header .navigation.sticky").css("z-index",""),jq("#proopc-order-submit").removeAttr("disabled")},addpageloader:function(){0==jq("#proopc-page-overlay").length&&jq("body").append('<div id="proopc-page-overlay"></div><div id="proopc-page-spinner"><span></span></div>'),jq("#header .navigation.sticky").css("z-index",2e9);var t=jq("body").outerHeight();jq("#proopc-page-overlay").css({display:"block",height:t}).animate({opacity:.7},300),jq("#proopc-page-spinner > span").append(proopc_loader.el)},removepageloader:function(){jq("#proopc-page-overlay").length>0&&jq("#proopc-page-overlay, #proopc-page-spinner").remove(),jq("#header .navigation.sticky").css("z-index","")},tooltip:function(){jq(".hover-tootip").hover(function(){var t=jq(this).attr("title");if(jq(this).data("tipText",t).removeAttr("title"),t.indexOf("::")>=0){var t=t.split("::"),e='<div class="tooltip-title">'+t[0]+'</div><div class="tooltip-body">'+t[1]+"</div>";jq('<p class="proopc-tooltip"></p>').html(e).appendTo("body").fadeIn("slow")}else{var e='<div class="tooltip-body">'+t+"</div>";jq('<p class="proopc-tooltip"></p>').html(e).appendTo("body").fadeIn("slow")}},function(){jq(this).attr("title",jq(this).data("tipText")),jq(".proopc-tooltip").remove()}).mousemove(function(t){var e=t.pageX+20,o=t.pageY+10;jq(".proopc-tooltip").css({top:o,left:e})})},fieldTip:function(){jq(".hasFieldTip").hover(function(){jq(this).attr("title")&&ProOPC.showFieldTip(this)},function(){ProOPC.removeFieldTip(this,!0)})},showFieldTip:function(t){var e=jq(t);if(!e.data("tip")){var o="field-tip-"+jq.now(),a=e.attr("title"),r=e.outerWidth(),s=e.offset(),i=jq('<p class="proopc-fieldtip"></p>').attr("id",o);e.data("tipText",a).attr("title","").data("tip","#"+o);var n='<div class="fieldtip-body">'+a+"</div>";i.html(n).css("visibility","hidden").appendTo("body");var p=i.outerWidth(),d=i.outerHeight()+6,c=s.top-d,l=s.left+(r-p)/2;i.css({top:c,left:l,visibility:""}).fadeIn(200),jq(window).resize(function(){var t;t&&clearTimeout(t),setTimeout(function(){r=e.outerWidth(),s=e.offset(),p=i.outerWidth(),d=i.outerHeight()+6,c=s.top-d,l=s.left+(r-p)/2,i.css({top:c,left:l})},200)})}},removeFieldTip:function(t,e){var o=jq(t),a=o.data("tip");a&&jq(a).length&&(o.data("tip",null),e&&o.attr("title",o.data("tipText")),jq(a).animate({opacity:0},200,function(){jq(this).remove()}))},style:function(){var t=0;if(jq(".proopc-register > .proopc-inner, .proopc-login > .proopc-inner").css("min-height",""),jq(".proopc-register > .proopc-inner, .proopc-login > .proopc-inner").each(function(){jq(this).height()>t&&(t=jq(this).height())}),jq(".proopc-register > .proopc-inner, .proopc-login > .proopc-inner").css("min-height",t),jq("#ProOPC").find("#dynamic_recaptcha_1").length){var e=jq("#ProOPC #dynamic_recaptcha_1").find("table"),o=e.width();jq(e).parents(".proopc-input").width(o);var a=jq(".proopc-register > .proopc-inner").width()-35;jq(e).parents(".proopc-input").siblings(".proopc-input-group-level").width(a-o)}var r,s;jq("table.cart-summary.proopc-table-striped td").each(function(){r=jq(this).text(),r=r?jq.trim(r):"",s=jq(this).html(),s=s?jq.trim(s):"",(!r.length&&!s.length||jq(this).is(":empty"))&&jq(this).addClass("cell-empty")}),jq("table.cart-summary.proopc-table-striped span.vm-price-desc").each(function(){r=jq(this).text(),r=r?jq.trim(r):"",s=jq(this).html(),s=s?jq.trim(s):"",(!r.length&&!s.length||jq(this).is(":empty"))&&jq(this).hide()}),jq(".proopc-p-price > div, .proopc-taxcomponent > div, .proopc-p-discount > div").each(function(){jq(this).is(":visible")&&jq(this).css("display","inline")}),jq(".proopc-login-message-cont").hover(function(){jq(".proopc-logout-cont").removeClass("hide")},function(){jq(".proopc-logout-cont").addClass("hide")}),jq('[data-vpopc="redirect"]').click(function(t){t.preventDefault();var e=jq(this).attr("data-vphref");return e?(window.location.href=e,!1):void 0}),jq(".proopc-logout-cont").css("min-width",jq(".proopc-loggedin-user").width()),"undefined"==typeof window.bonusCartItemIds||jq.each(window.bonusCartItemIds,function(t,e){if(!e.userCanUpdateQuantity){updateform=jq('input[data-vpid="'+e.cartItemId+'"]').parent(".proopc-input-append");var o=jq(updateform).children('input[name="quantity"]').val();jq(updateform).hasClass("bonusSet")||(updateform.before(o),jq(updateform).addClass("bonusSet")),updateform.hide(),updateform.parent().find("button.remove_from_cart").hide()}}),1==VPOPC.option.STYLERADIOCHEBOX&&(jq('#UserRegistration input[type="radio"], #EditBTAddres input[type="radio"], #EditSTAddres input[type="radio"]').each(function(){jq(this).css("float","left"),jq('label[for="'+jq(this).attr("id")+'"]').addClass("proopc-radio-label")}),jq('#UserRegistration input[type="checkbox"], #EditBTAddres input[type="checkbox"], #EditSTAddres input[type="checkbox"]').each(function(){jq(this).css({"float":"left",margin:"4px 5px 0 0"}),jq(this).parent(".proopc-input-append").css("padding-top","4px"),jq(this).siblings("br").remove(),jq('label[for="'+jq(this).attr("id")+'"]').css({"float":"left","padding-left":"10px","padding-right":"10px"}).insertAfter(this)})),jq(".proopc-creditcard-info").each(function(){if(0==jq(this).parent(".vmpayment_cardinfo").length){var t=jq(this).prevAll('input[name="virtuemart_paymentmethod_id"]'),e=jq(t).attr("id"),o=jq(t).data("pmtype");jq(t).data("paypalproduct")&&(o+=jq(t).data("paypalproduct"));var a="hide";jq("#"+e).is(":checked")&&(a="show"),jq(this).wrap('<span class="vmpayment_cardinfo additional-payment-info '+o+" "+a+'">')}}),klarnaloadneeded="undefined"==typeof klarna?!1:!0,klarnaloadneeded&&ProOPC.callKlarna(),jq("form#proopc-shipment-form").find("select").change(function(){jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=setshipments&"+jq("form#proopc-shipment-form").serialize(),cache:!1,success:function(t){if(t.error){var e='<div class="proopc-alert proopc-success-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+t.msg+"</div>";jq("#proopc-system-message").html(e),jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500)}else jq(document).trigger("shipmentUpdate",[jq("form#proopc-shipment-form")]),ProOPC.getcartlist()}})}),jq("form#proopc-shipment-form").find("select").each(function(){jq(this).width(jq(this).parents("fieldset").width())}),jq("form#proopc-payment-form").find("select").change(function(){if("sisowideal"==jq('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').data("pmtype")||"buckaroo"==jq('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').data("pmtype")){var t=jq("form#proopc-payment-form").serialize(),e="ctask=setpayment&savecc=1&payment_data=1";"piraeus"==jq('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').data("pmtype")&&(e="ctask=setpayment&payment_data=1"),jq.ajax({dataType:"json",url:VPOPC.option.URI,data:e+"&"+t,cache:!1,success:function(t){if(t.error){var e='<div class="proopc-alert proopc-success-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+t.msg+"</div>";jq("#proopc-system-message").html(e),jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500)}else jq(document).trigger("paymentUpdate",[jq("form#proopc-payment-form")]),ProOPC.getcartlist()}})}else"piraeus"==jq('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').data("pmtype")&&ProOPC.setpayment(jq('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked'))}),jq("#sisow_bank").width(jq("#sisow_bank").parent("fieldset").width()),jq("#monthinstallments").width(jq("#monthinstallments").parents(".proopc-row").width()),jq(".cc_type_sandbox").change(function(){var t=jq(this).attr("rel"),e=jq("#cc_type_"+t).val();switch(e){case"Visa":jq("#cc_number_"+t).val("4007000000027"),jq("#cc_cvv_"+t).val("123");break;case"Mastercard":jq("#cc_number_"+t).val("6011000000000012"),jq("#cc_cvv_"+t).val("123");break;case"Amex":jq("#cc_number_"+t).val("370000000000002"),jq("#cc_cvv_"+t).val("1234");break;case"Discover":jq("#cc_number_"+t).val("5424000000000015"),jq("#cc_cvv_"+t).val("123");break;case"Maestro":jq("#cc_number_"+t).val("6763318282526706"),jq("#cc_cvv_"+t).val("123");break;default:jq("#cc_number_"+t).val(""),jq("#cc_cvv_"+t).val("")}}),jq(".cc_type_sandbox").trigger("change");var i=jq(".vmpayment_cardinfo");if(i.parent().is("div")&&i.unwrap(),1==VPOPC.option.REMOVEUNNECESSARYLINKS&&(jq("span.vmpayment").find("a").each(function(){var t=jq(this).text();jq(this).parents("label").siblings(".vmpayment_cardinfo").prepend('<div class="proopc-payment-text">'+t+"</div>"),jq(this).remove()}),jq("#ProOPC").find('a[href="'+VPOPC.option.EDITPAYMENTURI+'"]').remove()),VPOPC.option.TOSFANCY){var n=jq("div#proopc-tos-fancy"),p=n.parent(),d=jQuery.easing.jswing||"undefined"!=jQuery.easing.jswing?"elastic":"fade";jq('[data-tos="fancybox"]').fancybox({titlePosition:"inside",padding:0,showCloseButton:!1,centerOnScroll:!0,transitionIn:"fade",transitionOut:d,overlayOpacity:.8,overlayColor:"#000",onClosed:function(){jq(this.href).length||(p.html(n),jq("button.fancy-close",n).click(function(t){t.preventDefault(),parent.jq.fancybox.close()}))}}),jq("div#proopc-tos-fancy button.fancy-close").click(function(t){t.preventDefault(),parent.jq.fancybox.close()})}if(VPOPC.option.RELOAD&&!jq("#ProOPC").hasClass("loaded")&&jq(".proopc-reload").length&&jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500,function(){jq("#ProOPC").addClass("loaded")}),jq("input.klarnaPayment:radio").length){jq("input.klarnaPayment:radio").attr("onclick","return ProOPC.setpayment(this);"),jq("input.klarnaPayment:radio").parents("table").addClass("proopc-klarna-payment");var o=jq("#proopc-payment-form").find('input:radio[name="virtuemart_paymentmethod_id"]:checked');ProOPC.klarnaOpenClose(o)}},close:function(t){jq(t).parent(".proopc-alert").remove()},validateForm:function(t){var e=VPOPC.JText._("PLG_VPONEPAGECHECKOUT_REQUIRED_FIELDS_MISSING"),o=!0;if(jq(t+' input[type="text"]:not(#proopc-secretkey),'+t+' input[type="password"],'+t+" input.required,"+t+" select.required").each(function(){jq('label[for="'+jq(this).attr("id")+'"]').removeClass("invalid"),""==jq(this).val()||jq(this).hasClass("invalid")?(jq(this).siblings(".status").removeClass("valid").addClass("invalid").attr("title",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_REQUIRED_FIELD")),o=!1):"checkbox"==jq(this).attr("type")&&0==jq(this).is(":checked")?(jq('label[for="'+jq(this).attr("id")+'"]').addClass("invalid"),o=!1):"radio"!=jq(this).attr("type")||jq('input[name="'+jq(this).attr("name")+'"]:checked').val()||(jq('label[for="'+jq(this).attr("id")+'"]').addClass("invalid"),o=!1)}),0==o){var a='<div class="proopc-alert proopc-error-msg"><button type="button" class="close" onclick="ProOPC.close(this);">&times;</button>'+e+"</div>";jq("#proopc-system-message").html(a),jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500)}return o},submitOrder:function(){jq("#proopc-system-message").html("");var t=!1,e=jq('label[for="virtuemart_state_id"]').text(),o=e&&e.length>0&&e.indexOf("*")>=0;if(o&&jq("#virtuemart_state_id optgroup").length>0&&""==jq("#virtuemart_state_id").val()&&jq("#virtuemart_state_id").addClass("required"),e=jq('label[for="shipto_virtuemart_state_id"]').text(),o=e&&e.length>0&&e.indexOf("*")>=0,o&&jq("#shipto_virtuemart_state_id optgroup").length>0&&""==jq("#shipto_virtuemart_state_id").val()&&jq("#shipto_virtuemart_state_id").addClass("required"),jq("#EditBTAddres select, #EditBTAddres input").each(function(){if(jq(this).hasClass("required")&&""==jq(this).val()){jq(this).addClass("invalid");var e=jq(this).attr("id");jq('label[for="'+e+'"]').addClass("invalid"),t=!0}else if(("email"==jq(this).attr("name")||"shipto_email"==jq(this).attr("name"))&&!ProOPC.validateEmail(jq(this).val())){jq(this).addClass("invalid");var e=jq(this).attr("id");jq('label[for="'+e+'"]').addClass("invalid"),t=!0}}),jq("#EditBTAddres select, #EditBTAddres input").change(function(){if(jq(this).hasClass("invalid")&&""!==jq(this).val()){jq(this).removeClass("invalid");var t=jq(this).attr("id");jq('label[for="'+t+'"]').removeClass("invalid")}}),jq("#STsameAsBT").is(":checked")?jq("#EditBTAddres input").each(function(){var t=jq(this).attr("id");jq("#shipto_"+t).val(jq(this).val())}):(jq("#EditSTAddres select, #EditSTAddres input").each(function(){if(jq(this).hasClass("required")&&""==jq(this).val()){jq(this).addClass("invalid");var e=jq(this).attr("id");jq('label[for="'+e+'"]').addClass("invalid"),t=!0}}),jq("#EditSTAddres select, #EditSTAddres input").change(function(){if(jq(this).hasClass("invalid")&&""!==jq(this).val()){jq(this).removeClass("invalid");var t=jq(this).attr("id");jq('label[for="'+t+'"]').removeClass("invalid")}})),t){var a='<div class="proopc-alert proopc-error-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+VPOPC.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")+"</div>";return jq("#proopc-system-message").html(a),jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500),!1}if(0==jq('#proopc-shipments input[name="virtuemart_shipmentmethod_id"]').is(":checked")){var a='<div class="proopc-alert proopc-error-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+VPOPC.JText._("COM_VIRTUEMART_CART_NO_SHIPMENT_SELECTED")+"</div>";return jq("#proopc-system-message").html(a),jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500),!1}if(0==jq('#proopc-payments input[name="virtuemart_paymentmethod_id"]').is(":checked")){var a='<div class="proopc-alert proopc-error-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+VPOPC.JText._("COM_VIRTUEMART_CART_NO_PAYMENT_SELECTED")+"</div>";return jq("#proopc-system-message").html(a),jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500),!1}var r=jq("#proopc-payment-form").find("input:radio[name=virtuemart_paymentmethod_id]:checked");if(r.hasClass("klarnaPayment")){var s=!1,i=[],n=r.parents("table");jq(n).find("input, select, textarea, .klarna_box_bottom_title").removeClass("invalid"),jq(n).find("input:visible").not(":checkbox").each(function(){""==jq(this).val()&&(jq(this).addClass("invalid"),jq(this).prev(".klarna_box_bottom_title").addClass("invalid"),i.push(jq(this).prev(".klarna_box_bottom_title").text()),s=!0)});var p=!1;jq(n).find("select").each(function(){(""==parseInt(jq(this).val())||0==parseInt(jq(this).val())||isNaN(parseInt(jq(this).val())))&&(jq(this).addClass("invalid"),jq(this).parents(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").addClass("invalid"),0==p&&(i.push(jq(this).parents(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").text()),p=!0),s=!0)}),jq(n).find('input[type="checkbox"]').each(function(){0==jq(this).is(":checked")&&(jq(this).addClass("invalid"),jq(this).next(".klarna_box_bottom_title").addClass("invalid"),i.push("Klarna: "+VPOPC.JText._("COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS")),s=!0)});var d="";jq(i).length>0&&(d=VPOPC.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")+": "+i.join(", ")+"."),jq(n).find("input, select, textarea").change(function(){jq(this).is("input")&&""!=jq(this).val()&&(jq(this).removeClass("invalid"),jq(this).prev(".klarna_box_bottom_title").removeClass("invalid")),!jq(this).is("select")||""==jq(this).val()&&"0"==jq(this).val()||(jq(this).removeClass("invalid"),jq(this).parents(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").removeClass("invalid")),jq(this).is("input:checkbox, input:radio")&&jq(this).is(":checked")&&(jq(this).removeClass("invalid"),jq(this).next(".klarna_box_bottom_title").removeClass("invalid"))})}if(s){var a='<div class="proopc-alert proopc-error-msg"><button type="button" class="close" onclick="ProOPC.close(this);">x</button>'+d+"</div>";return jq("#proopc-system-message").html(a),jq("html,body").animate({scrollTop:jq("#proopc-system-message").offset().top-100},500),!1}if((VPOPC.option.VMCONFIGTOS||jq('input[name="tos"]:checkbox').length)&&0==jq('input[name="tos"]:checkbox').is(":checked"))return ProOPC.setmsg(1,VPOPC.JText._("COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS")),!1;var c=jq("#EditBTAddres").serialize(),l=jq("#checkoutForm").serialize(),m=jq("#formToken input").attr("name"),P=jq("#formToken input").val(),u=c+"&"+l+"&ctask=savebtaddress&stage=final&"+m+"="+P;return jq.ajax({beforeSend:function(){ProOPC.addpageloader(),jq("#proopc-page-spinner").after('<div id="proopc-order-process"></div>'),jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS")),jq("#proopc-order-submit").attr("disabled","disabled")},dataType:"json",type:"POST",url:VPOPC.option.URI,data:u,cache:!1,success:function(t){if(1==t.error)return ProOPC.removepageloader(),ProOPC.setmsg(1,t.msg),jq("#proopc-order-submit").removeAttr("disabled"),!1;if(jq(document).trigger("vpopc.event",["checkout.bt.saved"]),jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_BILLING_ADDRESS_SAVED")),0==jq("#STsameAsBT").is(":checked")){var e=jq("#EditSTAddres").serialize(),o=jq("#formToken input").attr("name"),a=jq("#formToken input").val(),r=e+"&ctask=savestaddress&stage=final&"+o+"="+a;jq.ajax({beforeSend:function(){jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_SAVING_SHIPPING_ADDRESS"))},dataType:"json",type:"POST",async:!1,url:VPOPC.option.URI,data:r,success:function(t){return 1==t.error?(ProOPC.removepageloader(),ProOPC.setmsg(1,t.msg),jq("#proopc-order-submit").removeAttr("disabled"),!1):(jq(document).trigger("vpopc.event",["checkout.st.saved"]),jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_SHIPPING_ADDRESS_SAVED")),void setTimeout(function(){ProOPC.saveCCdata()},50))}})}else setTimeout(function(){ProOPC.saveCCdata()})}}),!1},saveCartFields:function(){var t=jq("form#checkoutForm").serialize();jq.ajax({beforeSend:function(){jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_SAVING_CART_FIELDS"))},dataType:"json",type:"POST",url:VPOPC.option.URI,async:!1,data:"ctask=savecartfields&&"+t,cache:!1,success:function(t){return t.error?(ProOPC.getcartlist(),ProOPC.removepageloader(),jq("#proopc-order-process").remove(),ProOPC.setmsg(1,t.msg),jq("#proopc-order-submit").removeAttr("disabled"),!1):(jq(document).trigger("vpopc.event",["checkout.cartfields.saved"]),jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_CART_FIELDS_SAVED")),setTimeout(function(){ProOPC.verifyCheckout()},50),!0)},error:function(t,e,o){console.log(t),console.log(e),console.log(o)}})},saveCCdata:function(){{var t=jq("form#proopc-payment-form").serialize();jq("#proopc-payment-form").find("input:radio[name=virtuemart_paymentmethod_id]:checked")}jq.ajax({beforeSend:function(){jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_SAVING_CREDIT_CARD"))},dataType:"json",type:"POST",url:VPOPC.option.URI,async:!1,data:"ctask=setpayment&ajax=1&savecc=1&"+t+"&payment_data=1",cache:!1,success:function(t,e,o){if(o.getResponseHeader("content-type").indexOf("text/html")>=0&&"undefined"!=typeof klarna){ProOPC.removepageloader(),jq("#proopc-order-process").remove(),jq("<div/>",{id:"proopc-temp",style:"display:none"}).appendTo("body"),jq("#proopc-temp").append(t);var a=jq("#proopc-temp").find("div#system-message-container").html();return ProOPC.setmsg(1,a),jq("#proopc-order-submit").removeAttr("disabled"),!1}return"string"==typeof t&&(t=jq.parseJSON(t)),t.error?(ProOPC.getcartlist(),ProOPC.removepageloader(),jq("#proopc-order-process").remove(),ProOPC.setmsg(1,t.msg),jq("#proopc-order-submit").removeAttr("disabled"),!1):0==t.redirect?(jq(document).trigger("vpopc.event",["checkout.paymentmethod.saved"]),jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED")),setTimeout(function(){ProOPC.saveCartFields()},50),!0):void(window.location=t.redirect)}})},saveAdditionalPaymentdata:function(){var t=jq("form#proopc-payment-form").serialize();jq("#proopc-order-submit").attr("disabled","disabled");jq("#proopc-payment-form").find("input:radio[name=virtuemart_paymentmethod_id]:checked");return jq.ajax({dataType:"json",type:"POST",url:VPOPC.option.URI,async:!1,data:"ctask=setpayment&ajax=1&savecc=1&"+t+"&payment_data=1",cache:!1,success:function(t,e,o){if(o.getResponseHeader("content-type").indexOf("text/html")>=0&&"undefined"!=typeof klarna){jq("#proopc-order-submit").removeAttr("disabled"),jq("<div/>",{id:"proopc-temp",style:"display:none"}).appendTo("body"),jq("#proopc-temp").append(t);var a=jq("#proopc-temp").find("div#system-message-container").html();ProOPC.setmsg(1,a),jq("#proopc-order-submit").removeAttr("disabled")}else"string"==typeof t&&(t=jq.parseJSON(t)),t.error?(ProOPC.getcartlist(),jq("#proopc-order-submit").removeAttr("disabled"),ProOPC.setmsg(1,t.msg)):0!=t.redirect?window.location=t.redirect:(jq(document).trigger("vpopc.event",["checkout.paymentmethod.additionaldata.saved"]),jq("#proopc-order-submit").removeAttr("disabled"),ProOPC.setmsg(4,VPOPC.JText._("PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED")))},error:function(t,e,o){console.log("error: saving additional payment details"),console.log(t),console.log(e),console.log(o)}}),!1},verifyCheckout:function(){jq.ajax({beforeSend:function(){jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_VERIFYING_ORDER"))},dataType:"json",type:"POST",async:!1,cache:!1,url:VPOPC.option.URI,data:"ctask=verifycheckout",success:function(t){return 0==t.error?(jq(document).trigger("vpopc.event",["checkout.orderVerification.success"]),jq("#proopc-order-process").text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_PLACING_ORDER")),jq("#checkoutForm").append(jq("#poropc-hidden-confirm").html()),setTimeout(function(){jq("#checkoutForm").submit()},50),!1):(jq(document).trigger("vpopc.event",["checkout.orderVerification.failed"]),ProOPC.removepageloader(),jq("#proopc-order-process").remove(),ProOPC.setmsg(1,t.msg),jq("#proopc-order-submit").removeAttr("disabled"),!1)},error:function(){console.log("error")}})},callKlarna:function(){var t=jq("#klarna_baloon").clone();jq("body").find(".klarna_baloon").remove();var e=jq("#klarna_blue_baloon").clone();if(jq("body").find(".klarna_blue_baloon").remove(),jq("body").append(t),jq("body").append(e),klarna.doDocumentIsReady(jq(".klarna_box")),jq(".klarna_box_bottom_languageInfo").remove(),!klarna.unary_checkout){var o=jq("#proopc-payment-form input[type=radio][name=virtuemart_paymentmethod_id]");ProOPC.initPaymentSelection(o.filter(":checked"))}klarna.baloons_moved=!0},initPaymentSelection:function(t){var e=t.hasClass("klarnaPayment");klarna.gChoice="",klarna.stype=t.data("stype"),e&&(klarna.gChoice=t.attr("id"));jQuery("#proopc-payment-form .klarnaPayment");ProOPC.klarnaOpenClose(t)},klarnaOpenClose:function(t){var e,o,a=jq(t).hasClass("klarnaPayment"),r=0;a&&(e=jq(t).parents(".proopc-klarna-payment"),e.siblings().find(".klarna_box_bottom:visible").hide(),jq('.proopc-klarna-payment input[name="klarna_paymentmethod"]').attr("disabled",!0),e.find('input[name="klarna_paymentmethod"]').removeAttr("disabled"),e.find(".klarna_box_bottom:hidden").css("opacity",0).show(),e.find('input[type="text"]').width("auto"),e.find("input:text:visible").each(function(){r=jq(this).parent("div").width(),r&&jq(this).css("max-width",r-13)}),jq(".proopc-klarna-payment .klarna_box_bottom_input_combo").each(function(){1==jq(this).children("div").length&&jq(this).children("div").width("100%")}),o=e.find(".klarna_box_bottom_right .klarna_box_bottom_content .btn-additional-klarna"),o.length||e.find(".klarna_box_bottom_right .klarna_box_bottom_content").append('<button type="button" class="proopc-btn btn-additional-klarna" onclick="return ProOPC.saveAdditionalPaymentdata();" style="margin-top: 15px;">'+VPOPC.JText._("COM_VIRTUEMART_SAVE")+"</button>"),jq(t).parents(".proopc-klarna-payment").find("div.klarna_box_bottom_title:visible, div.klarna_box_bottom_title:visible").removeAttr("style"),jq(t).parents(".proopc-klarna-payment").find("#box_klarna_consent_invoice:visible").parent("div").addClass("proopc-klarna-consent-container").width("auto"),jq(t).parents(".proopc-klarna-payment").find("#box_klarna_consent_part:visible").parent("div").addClass("proopc-klarna-consent-container").width("auto"),jq(t).parents(".proopc-klarna-payment").find(".klarna_box_bottom:visible").animate({opacity:1},300))},getKlarnaForm:function(){var t=jq("#proopc-payment-form").find("input:radio[name=virtuemart_paymentmethod_id]:checked");if(t.hasClass("klarnaPayment")){var e=t.parents("table"),o=e.find("*").serializeArray();o.push({name:"task",value:"setpayment"}),o.push({name:"view",value:"cart"}),o.push({name:"klarna_paymentmethod",value:t.next("input").val()});var a=jq("<form></form>");return jq.each(o,function(t,e){var o=jq("<input></input>");o.attr("type","hidden"),o.attr("name",e.name),o.attr("value",e.value),a.append(o)}),a}},loadPaymentScripts:function(){ProOPC.addloader("#proopc-payments"),jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=getpaymentscripts",cache:!1,success:function(t){jq("#proopc-payments").html(t.payments),""!==t.payment_scripts[0]&&(payment_scripts=t.payment_scripts),""!==t.payment_script[0]&&jq.each(t.payment_script,function(t,e){jq.getScript(e,function(){"undefined"!=typeof payment_scripts&&jq.each(payment_scripts,function(t,e){})})})},complete:function(){ProOPC.style(),ProOPC.tooltip(),ProOPC.removeloader("#proopc-payments"),ProOPC.defaultSP()},error:function(){console.log("Error: Error gettings Payment Scripts.")}})},loadShipmentScripts:function(){jq("#proopc-shipment-form").find("select").length<=0||(ProOPC.addloader("#proopc-shipments"),jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=getshipmentscripts",cache:!1,success:function(t){jq("#proopc-shipments").html(t.shipments),t.shipment_scripts.length>0&&""!==t.shipment_scripts[0]&&jq.each(t.shipment_scripts,function(t,e){jq("head, body").find('script[type="text/javascript"]').each(function(){var t=jq(this).attr("src");return"undefined"==typeof t||t===!1?(jq(this).append(e),!1):void 0
})})},complete:function(){ProOPC.style(),ProOPC.tooltip(),ProOPC.removeloader("#proopc-shipments"),ProOPC.defaultSP()},error:function(){console.log("Error: Error gettings Shipment Scripts.")}}))},getUrlVars:function(){for(var t,e={},o=["option","view","task","ctask"],a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<a.length;r++)t=a[r].split("="),-1==jq.inArray(t[0],o)&&"undefined"!=typeof t[1]&&null!=t[1]&&(e[t[0]]=t[1]);return jq.param(e)},canCheckout:function(){jq("#ProOPC").length&&!jq("#ProOPC").hasClass("emptyCart-view")&&(ProOPC._canCheckoutTask(),setInterval(function(){ProOPC._canCheckoutTask()},9e5))},_canCheckoutTask:function(){jq.ajax({dataType:"json",url:VPOPC.option.URI,data:"ctask=cancheckout",cache:!1,success:function(t){1==t.error?(jq("#ProOPC").removeClass("canCheckout"),1==t.reload&&window.location.reload(!0)):0==t.error&&jq("#ProOPC").addClass("canCheckout")},error:function(t,e,o){console.log("Error: ProOPC._canCheckoutTask."),console.log(t),console.log(e),console.log(o)}})},resetForm:function(t,e){jq(e,t).val(""),jq(t).submit()}};jq(document).ready(function(){if(navigator.userAgent.match(/IEMobile\/10\.0/)){var t=document.createElement("style");t.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.getElementsByTagName("head")[0].appendChild(t)}ProOPC.canCheckout(),ProOPC.spinnervars(),ProOPC.verifyRegForm(),ProOPC.tooltip(),ProOPC.fieldTip(),ProOPC.inputwidth(),ProOPC.selectwidth(),ProOPC.defaultSP(),ProOPC.productdetails()}),jq(document).ajaxStop(function(){ProOPC.productdetails()}),jq(window).load(function(){ProOPC.style()}),jq(window).resize(function(){var t=navigator.userAgent.toLowerCase(),e=t.indexOf("android")>-1;e||(ProOPC.style(),ProOPC.inputwidth(),ProOPC.selectwidth())})}